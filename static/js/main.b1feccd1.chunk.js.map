{"version":3,"sources":["firebase.ts","store/game/index.ts","store/game/actions.ts","game/Card.tsx","game/Game.tsx","App.tsx","store/index.ts","serviceWorker.ts","index.tsx"],"names":["firebase","initializeApp","apiKey","process","authDomain","databaseURL","projectId","db","firestore","game","createSlice","name","initialState","reducers","setGame","_","action","payload","updateGameState","state","data","Object","fromEntries","entries","map","k","v","FieldValue","sentinel","args","collection","doc","id","update","actions","createGameWebId","chars","Array","charAt","Math","floor","random","length","join","watchGame","ref","dispatch","onSnapshot","qs","Card","props","classNames","classnames","selected","matched","onClick","className","value","mapDispatch","connector","connect","webId","cards","i","key","toString","style","order","selectedCards","indexOf","matchedCards","card","concat","setTimeout","clearSelectedCards","selectCard","createGame","type","a","undefined","shuffle","range","add","loadGame","where","limit","get","empty","docs","maxLength","autoFocus","autoComplete","onChange","e","target","toUpperCase","reducer","store","configureStore","Boolean","window","location","hostname","match","ReactDOM","render","StrictMode","document","getElementById","navigator","serviceWorker","ready","then","registration","unregister","catch","error","console","message"],"mappings":"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","file":"static/js/main.b1feccd1.chunk.js","sourcesContent":["import firebase from 'firebase/app';\nimport 'firebase/firestore';\n\nconst firebaseConfig = {\n  apiKey: process.env.REACT_APP_FIREBASE_API_KEY,\n  authDomain: process.env.REACT_APP_FIREBASE_AUTH_DOMAIN,\n  databaseURL: process.env.REACT_APP_FIREBASE_DATABASE_URL,\n  projectId: process.env.REACT_APP_FIREBASE_PROJECT_ID,\n};\n\nfirebase.initializeApp(firebaseConfig);\n\nconst db = firebase.firestore();\n\nexport { firebase, db };\n","import { PayloadAction, createSlice } from '@reduxjs/toolkit';\nimport firebase from 'firebase';\nimport { db } from '../../firebase';\nimport { Game } from '../../models/Game';\nimport { FirestoreUpdateActionPayload } from '../index';\n\nconst game = createSlice({\n  name: 'game',\n  initialState: null as Game | null,\n  reducers: {\n    setGame: (_, action: PayloadAction<Game | null>) => action.payload,\n    updateGameState: (state, action: PayloadAction<FirestoreUpdateActionPayload<Game['state']>>) => {\n      if (state) {\n        const data = Object.fromEntries(Object.entries(action.payload).map(([k, v]) => {\n          if (v && 'sentinel' in v) {\n            v = firebase.firestore.FieldValue[v.sentinel](\n              // @ts-ignore\n              ...v.args);\n          }\n          return ['state.' + k, v];\n        }));\n        db.collection('games').doc(state.id).update(data);\n      }\n      return state;\n    },\n  },\n});\n\nexport const { setGame, updateGameState } = game.actions;\nexport default game.reducer;\n","import { ThunkAction } from 'redux-thunk';\nimport { range, shuffle } from 'lodash';\nimport { db } from '../../firebase';\nimport { New } from '../../models';\nimport { Game, GameType, MemoryGameProps, MemoryGameState } from '../../models/Game';\nimport { setGame } from '.';\n\n// TOOD: UNSUBSCRIBE WATCHER WHEN REF CHANGES\n// TODO: Factor these into regular actions\n\ntype Thunk = ThunkAction<void, any, any, any>;\ntype Ref<T> = firebase.firestore.DocumentReference<T>;\n\nexport function createGame(type: GameType, props?: Game['props']): Thunk {\n  return async dispatch => {\n    if (props === undefined) {\n      props = createGameProps();\n    }\n    const state = createGameState();\n    const webId = createGameWebId();\n    const game: New<Game> = { type, webId, props, state };\n    const ref = await db.collection('games').add(game) as Ref<Game>;\n    dispatch(watchGame(ref));\n  };\n}\n\nfunction createGameProps(): MemoryGameProps {\n  return {\n    cards: [...Array(24)].map((_, i) => Math.floor(i / 2).toString()),\n    order: shuffle(range(24)),\n  };\n}\n\nfunction createGameState(): MemoryGameState {\n  return {\n    selectedCards: [],\n    matchedCards: [],\n  };\n}\n\n// TODO: Guarantee uniqueness\nfunction createGameWebId(): string {\n  const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';\n  return [...Array(6)].map(() => chars.charAt(Math.floor(Math.random() * chars.length))).join('');\n}\n\nexport function loadGame(webId: Game['webId']): Thunk {\n  return async dispatch => {\n    const qs = await db.collection('games').where('webId', '==', webId).limit(1).get();\n    if (!qs.empty) {\n      const ref = qs.docs[0].ref as Ref<Game>;\n      dispatch(watchGame(ref));\n    }\n  };\n}\n\nexport function watchGame(ref: Ref<Game>): Thunk {\n  return dispatch => {\n    ref.onSnapshot(qs => {\n      const game = qs.data() || null;\n      if (game) {\n        game.id = ref.id;\n      }\n      dispatch(setGame(game));\n    });\n  };\n}\n\nexport { updateGameState } from '.';\n","import React from 'react';\nimport classnames from 'classnames';\nimport './Card.css';\n\ninterface CardProps {\n  value: string;\n  selected: boolean;\n  matched: boolean;\n  onClick: () => void;\n}\n\nconst Card: React.FC<CardProps> = props => {\n  const classNames = classnames('Card', props.selected ? 'Card__front' : 'Card__back', { 'Card__hidden': props.matched });\n\n  return (\n    <div onClick={props.onClick} className={classNames}>\n      {props.selected && props.value}\n    </div>\n  );\n};\n\nexport default Card;\n","import React from 'react';\nimport { Action, ActionCreator } from 'redux';\nimport { connect, ConnectedProps } from 'react-redux';\nimport { Game } from '../models/Game';\nimport { FirestoreUpdateActionPayload } from '../store';\nimport { updateGameState } from '../store/game/actions';\nimport './Game.css';\nimport Card from './Card';\n\nfunction selectCard(card: number, game: Game, updateGameState: ActionCreator<Action>) {\n  let { selectedCards } = game.state;\n\n  if (selectedCards.length >= 2) {\n    return;\n  }\n\n  if (card === selectedCards[0]) {\n    selectedCards = [];\n  } else {\n    selectedCards = selectedCards.concat(card);\n  }\n\n  updateGameState({ selectedCards });\n\n  if (selectedCards.length === 2) {\n    const matched = game.props.cards[selectedCards[0]] === game.props.cards[selectedCards[1]];\n    setTimeout(() => clearSelectedCards(matched, selectedCards, updateGameState), 2000);\n  }\n}\n\nfunction clearSelectedCards(matched: boolean, selectedCards: number[], updateGameState: ActionCreator<Action>) {\n  const data: FirestoreUpdateActionPayload<Game['state']> = { selectedCards: [] };\n\n  if (matched) {\n    data.matchedCards = { sentinel: 'arrayUnion', args: selectedCards };\n  }\n\n  updateGameState(data);\n}\n\nconst mapDispatch = { updateGameState };\nconst connector = connect(null, mapDispatch);\n\ninterface Props extends ConnectedProps<typeof connector> {\n  game: Game;\n}\n\nconst GameCmp: React.FC<Props> = ({ game, updateGameState }) => (\n  <div className=\"Game\">\n    <div className=\"Game__info\">\n      <h2>Game ID: {game.webId}</h2>\n    </div>\n\n    <div className=\"Game__table\">\n      {game && game.props.cards.map((v: any, i: any) => (\n        <div key={i.toString()} style={{ order: game.props.order[i] }}>\n          <Card value={v}\n            selected={game.state.selectedCards.indexOf(i) > -1}\n            matched={game.state.matchedCards.indexOf(i) > -1}\n            onClick={() => selectCard(i, game, updateGameState)}>\n          </Card>\n        </div>\n      ))}\n    </div>\n  </div>\n);\n\nexport default connector(GameCmp);\n","import React from 'react';\nimport { connect, ConnectedProps } from 'react-redux';\nimport { RootState } from './store';\nimport { createGame, loadGame } from './store/game/actions';\nimport Game from './game/Game';\nimport './App.css';\n\nconst mapState = ({ game }: RootState) => ({ game });\nconst mapDispatch = { createGame, loadGame };\nconst connector = connect(mapState, mapDispatch);\n\n// TODO: Factor out login input\n// TODO: Add turn taking\n// TODO: Add score\n// TODO: Add completion (win/lose)\n// TODO: Add error handling\n// TODO: Add custom game setup\n// TODO: Add user accounts\n// TODO: Add tests\n// TODO: Update readme\n// TODO: Add deploy script\n\nconst App: React.FC<ConnectedProps<typeof connector>> = ({ game, createGame, loadGame }) => {\n  return (\n    <div className=\"App\">\n      {game ?\n        <Game game={game}></Game> :\n        <div className=\"App__login\">\n          <div className=\"App__login_input\">\n            <h2>Enter your game code:</h2>\n            <input type=\"text\"\n              maxLength={6}\n              autoFocus\n              autoComplete=\"off\"\n              onChange={e => {\n                // TODO: Factor out. Use state?\n                // TODO: Add loading spinner with error handling\n                if (e.target.value.length === 6) {\n                  loadGame(e.target.value.toUpperCase());\n                }\n              }}>\n            </input>\n          </div>\n\n          <div>\n            <a onClick={() => createGame('memory')}><small>Start a new game</small></a>\n          </div>\n        </div>\n      }\n    </div>\n  );\n}\n\nexport default connector(App);\n","import { configureStore } from '@reduxjs/toolkit';\nimport game from './game';\nimport firebase from 'firebase';\n\nconst reducer = { game };\nconst store = configureStore({ reducer });\n\nexport default store;\n\ntype FirestoreUpdateSentinelProxy = { sentinel: keyof Omit<typeof firebase.firestore.FieldValue, 'prototype'>, args: any[] };\nexport type FirestoreUpdateActionPayload<T> = Partial<{ [k in keyof T]: T[k] | FirestoreUpdateSentinelProxy }>;\nexport type RootState = ReturnType<typeof store.getState>;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { Provider } from 'react-redux';\nimport './index.css';\nimport App from './App';\nimport store from './store';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(\n  <React.StrictMode>\n    <Provider store={store}>\n      <App />\n    </Provider>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}